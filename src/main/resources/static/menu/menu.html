<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Menu Principal</title>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body { font-family:-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
           background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
           min-height:100vh; display:flex; justify-content:center; align-items:center; padding:20px; position:relative;}
    .menu-container { background:white; border-radius:24px; box-shadow:0 20px 60px rgba(0,0,0,0.3);
                     overflow:hidden; width:100%; max-width:500px; position:relative; z-index:1;}
    .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding:50px 30px; text-align:center; color:white;}
    h1 { font-size:2.5rem; font-weight:700; margin-bottom:8px; letter-spacing:-0.5px;}
    .subtitle { font-size:1rem; opacity:0.9; font-weight:400;}
    .menu-content { padding:30px; }
    .menu { display:flex; flex-direction:column; gap:14px; margin-bottom:25px;}
    .menu button { padding:16px 20px; border:none; border-radius:14px; font-size:1.1rem; font-weight:600;
                   cursor:pointer; transition: all 0.3s; font-family:inherit; text-align:left; display:flex; align-items:center; gap:12px;}
    .menu button::before { content:attr(data-icon); font-size:1.3rem; }
    .menu button:not(:disabled) { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color:white; box-shadow:0 4px 12px rgba(102,126,234,0.3);}
    .menu button:not(:disabled):hover { transform:translateY(-2px); box-shadow:0 6px 20px rgba(102,126,234,0.4);}
    .menu button:not(:disabled):active { transform:translateY(0);}
    .divider { height:1px; background: linear-gradient(to right, transparent, #e5e7eb, transparent); margin:25px 0;}
    .output { background:#f8f9ff; border:2px solid #e5e7eb; border-radius:12px; padding:16px; text-align:center;
              color:#374151; font-size:0.95rem; font-weight:500; }
  </style>
</head>
<body>

<div class="menu-container">
  <div class="header">
    <h1>Menu Principal</h1>
    <p class="subtitle">G√©rez votre espace</p>
  </div>

  <div class="menu-content">
    <div class="menu">
      <button id="btnProfil" data-icon="üë§">Mon Profil</button>
      <button id="btnListeProfils" data-icon="üë•">Liste des membres</button>
      <button id="btnMessages" data-icon="üí¨">Apercu des postes des membres</button>
      <button id="btnEcrireMessage" data-icon="‚úèÔ∏è">Ecrire un post</button>
      <button id="btnMaMessagerie" data-icon="üì®">Ma messagerie</button>
      <button id="btnPlaylists" data-icon="üéµ">Playlists musicales</button>
    </div>

    <div class="divider"></div>

    <div class="menu">
      <button id="btnLogout" data-icon="üö™">D√©connexion</button>
    </div>

    <div class="output" id="output">S√©lectionnez une option ci-dessus</div>
  </div>
</div>

<script>
  const output = document.getElementById("output");

  // V√©rifier l'authentification
  const token = localStorage.getItem('accessToken');
  if (!token) {
    alert('Vous devez √™tre connect√© pour acc√©der au menu');
    window.location.href = '/connection/connection.html';
  }

  async function checkAuth() {
    try {
      const response = await fetch('/api/users/me', {
        headers: { 'Authorization': 'Bearer ' + token }
      });
      if (!response.ok) throw new Error('Token invalide');
    } catch (err) {
      localStorage.removeItem('accessToken');
      localStorage.removeItem('refreshToken');
      alert('Session expir√©e');
      window.location.href = '/connection/connection.html';
    }
  }
  checkAuth();

  // Navigation boutons
  document.getElementById("btnProfil").addEventListener("click", ()=>{ output.textContent="Ouverture de votre profil..."; setTimeout(()=>{window.location.href="profil.html";},300);});
  document.getElementById("btnListeProfils").addEventListener("click", ()=>{ output.textContent="Ouverture de la liste des profils..."; setTimeout(()=>{window.location.href="afficherUserList.html";},300);});
  document.getElementById("btnMessages").addEventListener("click", ()=>{ output.textContent="Ouverture de la liste des messages..."; setTimeout(()=>{window.location.href="affichermessages.html";},300);});
  document.getElementById("btnEcrireMessage").addEventListener("click", ()=>{ output.textContent="Ouverture de la page d'√©criture..."; setTimeout(()=>{window.location.href="ecriremessage.html";},300);});
  document.getElementById("btnMaMessagerie").addEventListener("click", ()=>{ output.textContent="Ouverture de votre messagerie..."; setTimeout(()=>{window.location.href="messagerie.html";},300);});
  document.getElementById("btnPlaylists").addEventListener("click", ()=>{ output.textContent="Ouverture des playlists musicales..."; setTimeout(()=>{window.location.href="musicmenu.html";},300);});

  // üîπ Bouton D√©connexion
  document.getElementById("btnLogout").addEventListener("click", async () => {
    const refreshToken = localStorage.getItem('refreshToken');
    if (!refreshToken) return;

    try {
      const response = await fetch('/api/auth/logout', {
        method: 'POST',
        headers: { 'Content-Type':'application/json' },
        body: JSON.stringify({ refreshToken })
      });
      if (response.ok) {
        localStorage.removeItem('accessToken');
        localStorage.removeItem('refreshToken');
        alert('D√©connexion r√©ussie');
        window.location.href = '/connection/connection.html';
      } else {
        alert('Erreur lors de la d√©connexion');
      }
    } catch (err) {
      alert('Erreur r√©seau lors de la d√©connexion');
    }
  });
</script>

</body>
</html>
