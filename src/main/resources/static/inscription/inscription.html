// Dans inscription.html, remplace cette partie du JavaScript:

document.getElementById("signupForm").addEventListener("submit", async (e) => {
e.preventDefault();

const fileInput = document.getElementById("photo");
const submitBtn = document.getElementById("submitBtn");
const errorMsg = document.getElementById("errorMsg");

// ======== VÉRIFICATION 1: Photo sélectionnée ? ========
if (!fileInput.files || fileInput.files.length === 0) {
alert("❌ Erreur: Aucune photo sélectionnée!");
return;
}

const file = fileInput.files[0];

// ======== VÉRIFICATION 2: Type de fichier ========
const allowedTypes = ["image/jpeg", "image/jpg", "image/png", "image/gif", "image/webp"];
if (!allowedTypes.includes(file.type)) {
alert("❌ Erreur: Le fichier doit être une image (JPG, PNG, GIF, WebP)");
return;
}

// ======== VÉRIFICATION 3: Taille du fichier ========
const maxSize = 5 * 1024 * 1024; // 5MB
if (file.size > maxSize) {
alert("❌ Erreur: Le fichier est trop gros (max 5MB)");
return;
}

// ======== VÉRIFICATION 4: Nom de fichier valide ========
if (!file.name || file.name.trim() === "") {
alert("❌ Erreur: Nom de fichier invalide");
return;
}

// ======== VÉRIFICATION 5: Tous les champs remplis ========
const username = document.getElementById("username").value.trim();
const email = document.getElementById("email").value.trim();
const password = document.getElementById("password").value.trim();

if (!username || !email || !password) {
alert("❌ Erreur: Tous les champs doivent être remplis");
return;
}

// ======== Si tout est bon, créer FormData ========
const formData = new FormData();
formData.append("username", username);
formData.append("email", email);
formData.append("password", password);
formData.append("file", file); // Ajouter le fichier

submitBtn.disabled = true;
submitBtn.textContent = "Inscription...";

try {
const resp = await fetch("/api/users/register", {
method: "POST",
body: formData
});

// ======== VÉRIFICATION 6: Réponse du serveur ========
if (!resp.ok) {
const errorText = await resp.text();
alert("❌ Erreur inscription: " + errorText);
errorMsg.textContent = "Erreur: " + errorText;
errorMsg.style.display = "block";
return;
}

// ======== Succès ! ========
alert("✅ Inscription réussie!");
window.location.href = "/index.html";

} catch (err) {
alert("❌ Erreur réseau: " + err.message);
errorMsg.textContent = "Erreur réseau: " + err.message;
errorMsg.style.display = "block";
console.error("Erreur inscription:", err);

} finally {
submitBtn.disabled = false;
submitBtn.textContent = "S'inscrire";
}
});